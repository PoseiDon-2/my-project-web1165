"use strict";(()=>{var e={};e.id=459,e.ids=[459],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},19088:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{DELETE:()=>c,GET:()=>p,PATCH:()=>l});var o=t(49303),n=t(88716),a=t(60670),i=t(87070),u=t(24544),d=t(92704);async function p(e,{params:r}){try{let e=await u.cm.findById(r.id);if(!e)return i.NextResponse.json({error:"ไม่พบคำขอที่ระบุ"},{status:404});return await u.cm.incrementViewCount(r.id),i.NextResponse.json(e)}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error(`Get donation request error for ID ${r.id}:`,t),i.NextResponse.json({error:"เกิดข้อผิดพลาดในการดึงข้อมูลคำขอ",details:e},{status:500})}}async function l(e,{params:r}){try{let t=await (0,d.lj)(e);if(200!==t.status)return t;let s=e.headers.get("x-user-id"),o=e.headers.get("x-user-role"),n=await u.cm.findById(r.id);if(!n)return i.NextResponse.json({error:"ไม่พบคำขอที่ระบุ"},{status:404});if("ADMIN"!==o&&n.organizerId!==s)return i.NextResponse.json({error:"ไม่มีสิทธิ์แก้ไขคำขอนี้"},{status:403});let a=await e.json(),p=await u.cm.update(r.id,a);return i.NextResponse.json({message:"อัปเดตคำขอสำเร็จ",request:p})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error(`Update donation request error for ID ${r.id}:`,t),i.NextResponse.json({error:"เกิดข้อผิดพลาดในการอัปเดตคำขอ",details:e},{status:500})}}async function c(e,{params:r}){try{let t=await (0,d.lj)(e);if(200!==t.status)return t;let s=e.headers.get("x-user-id"),o=e.headers.get("x-user-role"),n=await u.cm.findById(r.id);if(!n)return i.NextResponse.json({error:"ไม่พบคำขอที่ระบุ"},{status:404});if("ADMIN"!==o&&n.organizerId!==s)return i.NextResponse.json({error:"ไม่มีสิทธิ์ลบคำขอนี้"},{status:403});return await u.cm.delete(r.id),i.NextResponse.json({message:"ลบคำขอบริจาคสำเร็จ"},{status:200})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error(`Delete donation request error for ID ${r.id}:`,t),i.NextResponse.json({error:"เกิดข้อผิดพลาดในการลบคำขอ",details:e},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/donation-requests/[id]/route",pathname:"/api/donation-requests/[id]",filename:"route",bundlePath:"app/api/donation-requests/[id]/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\donation-requests\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:h}=x,m="/api/donation-requests/[id]/route";function j(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},92704:(e,r,t)=>{t.d(r,{So:()=>a,lj:()=>n});var s=t(87070),o=t(90455);async function n(e){let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!r)return s.NextResponse.json({error:"ไม่พบ token การยืนยันตัวตน"},{status:401});let t=await (0,o.WX)(r);if(!t)return s.NextResponse.json({error:"Token ไม่ถูกต้องหรือหมดอายุ"},{status:401});let n=new Headers(e.headers);return n.set("x-user-id",t.id),n.set("x-user-role",t.role),s.NextResponse.next({request:{headers:n}})}async function a(e){let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!r)return console.log("No token provided"),null;let t=await (0,o.WX)(r);return console.log("Authenticated user:",t),t||null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,1482,8691,1585,603],()=>t(19088));module.exports=s})();