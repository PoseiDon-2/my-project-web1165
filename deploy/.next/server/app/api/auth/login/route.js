"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},48302:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>Z,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var a={};o.r(a),o.d(a,{POST:()=>d});var n=o(49303),i=o(88716),r=o(60670),l=o(87070),s=o(30971),p=o(72331),u=o(90455);async function d(e){try{let t=await e.json(),o=s.dm.parse(t),a=await p._.user.findUnique({where:{email:o.email}});if(!a)return l.NextResponse.json({error:"อีเมลหรือรหัสผ่านไม่ถูกต้อง"},{status:401});if("ACTIVE"!==a.status)return l.NextResponse.json({error:"บัญชีของคุณถูกระงับ กรุณาติดต่อผู้ดูแลระบบ"},{status:401});if(!await (0,u.Gv)(o.password,a.password))return l.NextResponse.json({error:"อีเมลหรือรหัสผ่านไม่ถูกต้อง"},{status:401});await p._.user.update({where:{id:a.id},data:{updatedAt:new Date}});let n=(0,u.RA)({id:a.id,email:a.email,firstName:a.firstName||"",lastName:a.lastName||"",role:a.role,organizationId:a.organizationId||void 0}),{password:i,...r}=a;return l.NextResponse.json({message:"เข้าสู่ระบบสำเร็จ",user:r,token:n})}catch(e){if(console.error("Login error:",e),"ZodError"===e.name)return l.NextResponse.json({error:"ข้อมูลไม่ถูกต้อง",details:e.errors},{status:400});return l.NextResponse.json({error:"เกิดข้อผิดพลาดในการเข้าสู่ระบบ"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:_,serverHooks:g}=m,Z="/api/auth/login/route";function y(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}},90455:(e,t,o)=>{o.d(t,{Gv:()=>s,RA:()=>p,WX:()=>u,c_:()=>l});var a=o(98691),n=o(41482),i=o.n(n);let r=process.env.JWT_SECRET||"your-secret-key";async function l(e){return a.ZP.hash(e,12)}async function s(e,t){return a.ZP.compare(e,t)}function p(e){let t={id:e.id,email:e.email,role:e.role,firstName:e.firstName,lastName:e.lastName,organizationId:e.organizationId},o=i().sign(t,r,{expiresIn:"7d"});return console.log("Generated token payload:",t),console.log("Generated token:",o),o}function u(e){try{let t=i().verify(e,r);return console.log("Decoded token:",t),t}catch(e){return console.error("Token verification failed:",e.message),null}}},72331:(e,t,o)=>{o.d(t,{_:()=>n});var a=o(53524);let n=globalThis.prisma??new a.PrismaClient},30971:(e,t,o)=>{o.d(t,{K3:()=>r,Pc:()=>u,dm:()=>i,g2:()=>p,gY:()=>d,jT:()=>s,lp:()=>l});var a=o(91585),n=o(53524);let i=a.Ry({email:a.Z_().email("อีเมลไม่ถูกต้อง"),password:a.Z_().min(1,"กรุณากรอกรหัสผ่าน")}),r=a.Ry({requestId:a.Z_().min(1,"กรุณาเลือกคำขอ"),amount:a.Rx().positive("จำนวนเงินต้องมากกว่า 0"),message:a.Z_().optional(),anonymous:a.O7().default(!1),paymentMethod:a.Z_().min(1,"กรุณาเลือกวิธีการชำระเงิน")}),l=a.Ry({requestId:a.Z_().min(1,"กรุณาเลือกคำขอ"),message:a.Z_().min(10,"ข้อความต้องมีอย่างน้อย 10 ตัวอักษร"),skills:a.Z_().optional(),experience:a.Z_().optional(),availability:a.Z_().optional(),hoursCommitted:a.Rx().positive().optional()});a.Ry({title:a.Z_().min(1,"กรุณากรอกหัวข้อ"),content:a.Z_().min(50,"เนื้อหาต้องมีอย่างน้อย 50 ตัวอักษร"),requestId:a.Z_().optional(),images:a.IX(a.Z_()).default([])});let s=a.Ry({title:a.Z_().min(1,"ต้องระบุหัวข้อ"),description:a.Z_().min(1,"ต้องระบุรายละเอียด"),category:a.Z_().min(1,"ต้องระบุหมวดหมู่"),address:a.Z_().nullable(),urgency:a.Km(["LOW","MEDIUM","HIGH","URGENT"]).optional().default("LOW"),acceptsMoney:a.O7().optional().default(!1),acceptsItems:a.O7().optional().default(!1),acceptsVolunteer:a.O7().optional().default(!1),targetAmount:a.Rx().optional().default(0),itemsNeeded:a.IX(a.Z_()).optional().nullable(),volunteersNeeded:a.Rx().int().min(0).optional().default(0),volunteerSkills:a.IX(a.Z_()).optional().default([]),volunteerDuration:a.Z_().nullable(),images:a.IX(a.Z_().url()).optional().default([]),documents:a.Ry({detailedAddress:a.Z_().nullable(),contactPhone:a.Z_().nullable(),bankAccount:a.Ry({bank:a.Z_().optional(),accountNumber:a.Z_().optional(),accountName:a.Z_().optional()}).optional(),organizationDetails:a.Ry({organizationType:a.Z_().optional(),registrationNumber:a.Z_().optional(),taxId:a.Z_().optional()}).optional()}).optional()}),p=a.Ry({title:a.Z_().optional(),description:a.Z_().optional(),categoryId:a.Z_().optional(),targetAmount:a.Rx().optional(),address:a.Z_().optional(),urgency:a.Km(["LOW","MEDIUM","HIGH"]).optional(),acceptsMoney:a.O7().optional(),acceptsItems:a.O7().optional(),acceptsVolunteer:a.O7().optional(),itemsNeeded:a.IX(a.Z_()).optional(),volunteersNeeded:a.Rx().optional(),volunteerSkills:a.IX(a.Z_()).optional(),volunteerDuration:a.Z_().optional(),images:a.IX(a.Z_()).optional(),documents:a.IM(a.Z_(),a.Yj()).optional(),status:a.Km(["PENDING","COMPLETED","CANCELLED","DRAFT","APPROVED","REJECTED"]).optional(),expiresAt:a.Z_().datetime().optional()}),u=a.Ry({email:a.Z_().email("กรุณาระบุอีเมลที่ถูกต้อง"),password:a.Z_().min(8,"รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร"),firstName:a.Z_().min(1,"กรุณาระบุชื่อ"),lastName:a.Z_().min(1,"กรุณาระบุนามสกุล"),phone:a.Z_().min(10,"กรุณาระบุหมายเลขโทรศัพท์ที่ถูกต้อง").regex(/^\d{10}$/,"หมายเลขโทรศัพท์ต้องมี 10 หลัก"),role:a.jb(n.user_role,{errorMap:()=>({message:"กรุณาระบุบทบาท"})}),organizationId:a.Z_().optional(),newOrganizationName:a.Z_().optional(),organizationType:a.jb(n.organization_type,{errorMap:()=>({message:"กรุณาระบุประเภทองค์กรที่ถูกต้อง"})}).optional(),registrationNumber:a.Z_().optional(),templeId:a.Z_().optional(),interests:a.IX(a.Z_()).optional(),bio:a.Z_().optional(),documents:a.Ry({idCard:a.Yj().optional(),organizationCert:a.Yj().optional()}).optional()}),d=u.refine(e=>"ORGANIZER"!==e.role||e.organizationId&&"other"!==e.organizationId||e.newOrganizationName&&e.organizationType,{message:"กรุณาระบุข้อมูลองค์กรให้ครบถ้วน (ต้องมี newOrganizationName และ organizationType) สำหรับผู้จัดงาน",path:["organizationId","organizationType"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),a=t.X(0,[9276,5972,1482,8691,1585],()=>o(48302));module.exports=a})();