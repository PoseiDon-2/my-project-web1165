"use strict";(()=>{var e={};e.id=8133,e.ids=[8133],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},87430:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>c,dynamic:()=>p});var o=r(49303),s=r(88716),n=r(60670),i=r(87070),l=r(72331),u=r(92704);let p="force-dynamic";async function c(e){try{let t=await (0,u.So)(e);if(!t)return i.NextResponse.json({error:"ไม่พบข้อมูลผู้ใช้หรือ token ไม่ถูกต้อง"},{status:401});if(!["ORGANIZER","ADMIN"].includes(t.role))return i.NextResponse.json({error:"ไม่มีสิทธิ์เข้าถึง"},{status:403});let r=(await l._.volunteerApplication.findMany({where:{request:{organizerId:t.id}},select:{id:!0,message:!0,skills:!0,experience:!0,availability:!0,status:!0,hoursCommitted:!0,startDate:!0,endDate:!0,createdAt:!0,updatedAt:!0,approvedAt:!0,completedAt:!0,requestId:!0,volunteer:{select:{id:!0,firstName:!0,lastName:!0,email:!0,phone:!0}}}})).map(e=>({id:e.id,name:`${e.volunteer.firstName||""} ${e.volunteer.lastName||""}`.trim(),email:e.volunteer.email,phone:e.volunteer.phone||"",message:e.message||"",skills:e.skills&&Array.isArray(e.skills)?e.skills:[],experience:e.experience||"",availability:e.availability||"",status:e.status.toLowerCase(),hoursCommitted:e.hoursCommitted||0,startDate:e.startDate?.toISOString()||"",endDate:e.endDate?.toISOString()||"",appliedDate:e.createdAt.toISOString(),requestId:e.requestId}));return i.NextResponse.json(r)}catch(e){return console.error("Error fetching volunteer applications:",e),i.NextResponse.json({error:e.message||"เกิดข้อผิดพลาดในการดึงข้อมูลผู้สมัครอาสาสมัคร"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/volunteer-applications/route",pathname:"/api/volunteer-applications",filename:"route",bundlePath:"app/api/volunteer-applications/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\volunteer-applications\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:g}=d,h="/api/volunteer-applications/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}},90455:(e,t,r)=>{r.d(t,{Gv:()=>l,RA:()=>u,WX:()=>p,c_:()=>i});var a=r(98691),o=r(41482),s=r.n(o);let n=process.env.JWT_SECRET||"your-secret-key";async function i(e){return a.ZP.hash(e,12)}async function l(e,t){return a.ZP.compare(e,t)}function u(e){let t={id:e.id,email:e.email,role:e.role,firstName:e.firstName,lastName:e.lastName,organizationId:e.organizationId},r=s().sign(t,n,{expiresIn:"7d"});return console.log("Generated token payload:",t),console.log("Generated token:",r),r}function p(e){try{let t=s().verify(e,n);return console.log("Decoded token:",t),t}catch(e){return console.error("Token verification failed:",e.message),null}}},92704:(e,t,r)=>{r.d(t,{So:()=>n,lj:()=>s});var a=r(87070),o=r(90455);async function s(e){let t=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!t)return a.NextResponse.json({error:"ไม่พบ token การยืนยันตัวตน"},{status:401});let r=await (0,o.WX)(t);if(!r)return a.NextResponse.json({error:"Token ไม่ถูกต้องหรือหมดอายุ"},{status:401});let s=new Headers(e.headers);return s.set("x-user-id",r.id),s.set("x-user-role",r.role),a.NextResponse.next({request:{headers:s}})}async function n(e){let t=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!t)return console.log("No token provided"),null;let r=await (0,o.WX)(t);return console.log("Authenticated user:",r),r||null}},72331:(e,t,r)=>{r.d(t,{_:()=>o});var a=r(53524);let o=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972,1482,8691],()=>r(87430));module.exports=a})();