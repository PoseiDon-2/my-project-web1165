"use strict";(()=>{var e={};e.id=6553,e.ids=[6553],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},95718:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>c,dynamic:()=>d});var n=r(49303),s=r(88716),a=r(60670),i=r(87070),u=r(72331),l=r(90455);let d="force-dynamic";async function c(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return i.NextResponse.json({error:"No token provided"},{status:401});let r=t.replace("Bearer ","").trim();if(!r||"undefined"===r)return i.NextResponse.json({error:"Token invalid"},{status:401});let o=null;try{o=(0,l.WX)(r)}catch(e){return i.NextResponse.json({error:"Invalid or malformed token"},{status:401})}if(!o)return i.NextResponse.json({error:"Invalid token"},{status:401});if("ADMIN"!==o.role)return i.NextResponse.json({error:"Unauthorized: Admin role required"},{status:403});let[n,s,a,d,c,p]=await Promise.all([u._.user.count({where:{role:"DONOR"}}),u._.user.count({where:{role:"ORGANIZER"}}),u._.donationRequest.count(),u._.donationRequest.count({where:{status:"PENDING"}}),u._.donationRequest.count({where:{status:"APPROVED"}}),u._.donation.aggregate({_sum:{amount:!0},where:{status:"COMPLETED",type:"MONEY"}})]),m=Number(p._sum?.amount??0);return i.NextResponse.json({totalUsers:n+s,totalDonors:n,totalOrganizers:s,totalRequests:a,pendingRequests:d,activeRequests:c,totalRaised:m},{status:200})}catch(e){return console.error("Error fetching admin stats",{error:e.message}),i.NextResponse.json({error:"Failed to fetch stats"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/stats/route",pathname:"/api/admin/stats",filename:"route",bundlePath:"app/api/admin/stats/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\admin\\stats\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=p,x="/api/admin/stats/route";function g(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},90455:(e,t,r)=>{r.d(t,{Gv:()=>u,RA:()=>l,WX:()=>d,c_:()=>i});var o=r(98691),n=r(41482),s=r.n(n);let a=process.env.JWT_SECRET||"your-secret-key";async function i(e){return o.ZP.hash(e,12)}async function u(e,t){return o.ZP.compare(e,t)}function l(e){let t={id:e.id,email:e.email,role:e.role,firstName:e.firstName,lastName:e.lastName,organizationId:e.organizationId},r=s().sign(t,a,{expiresIn:"7d"});return console.log("Generated token payload:",t),console.log("Generated token:",r),r}function d(e){try{let t=s().verify(e,a);return console.log("Decoded token:",t),t}catch(e){return console.error("Token verification failed:",e.message),null}}},72331:(e,t,r)=>{r.d(t,{_:()=>n});var o=r(53524);let n=globalThis.prisma??new o.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,1482,8691],()=>r(95718));module.exports=o})();