"use strict";(()=>{var e={};e.id=1317,e.ids=[1317],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},33195:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>I,staticGenerationAsyncStorage:()=>R});var o={};a.r(o),a.d(o,{DELETE:()=>Z,GET:()=>g,PUT:()=>N});var r=a(49303),n=a(88716),s=a(60670),i=a(87070),l=a(72331),u=a(90455),d=a(91585),p=a(26033),m=a(30971),c=a(53524);let _=m.Pc.omit({password:!0}).extend({password:d.Z_().min(6,"Password must be at least 6 characters").optional(),status:d.Km([c.user_status.ACTIVE,c.user_status.SUSPENDED,c.user_status.INACTIVE]).optional()});async function g(e,{params:t}){let a=e.headers.get("authorization")?.replace("Bearer ","");if(!a)return i.NextResponse.json({error:"No token provided",status:401},{status:401});let o=(0,u.WX)(a);if(!o||"ADMIN"!==o.role)return i.NextResponse.json({error:"Unauthorized",status:401},{status:401});try{let e=await l._.user.findUnique({where:{id:t.id},select:{id:!0,firstName:!0,lastName:!0,email:!0,role:!0,createdAt:!0,status:!0,_count:{select:{donationRequests:!0}},donations:{select:{amount:!0},where:{type:"MONEY",status:"COMPLETED"}}}});if(!e)return i.NextResponse.json({error:"User not found",status:404},{status:404});let a={id:e.id,name:`${e.firstName||""} ${e.lastName||""}`.trim()||e.email,email:e.email,role:e.role,joinDate:e.createdAt.toISOString(),isVerified:"ACTIVE"===e.status,requestsCreated:"ORGANIZER"===e.role?e._count.donationRequests:void 0,totalDonated:"DONOR"===e.role?e.donations.reduce((e,t)=>e+Number(t.amount),0):void 0};return i.NextResponse.json({data:a,status:200})}catch(e){return console.error("Error fetching user:",e),i.NextResponse.json({error:"Failed to fetch user",status:500},{status:500})}}async function N(e,{params:t}){let a=e.headers.get("authorization")?.replace("Bearer ","");if(!a)return i.NextResponse.json({error:"No token provided",status:401},{status:401});let o=(0,u.WX)(a);if(!o||"ADMIN"!==o.role)return i.NextResponse.json({error:"Unauthorized",status:401},{status:401});try{let a=await e.json(),r=_.parse(a),n={};r.firstName&&(n.firstName=r.firstName),r.lastName&&(n.lastName=r.lastName),r.email&&(n.email=r.email),r.role&&(n.role=r.role),r.status&&(n.status=r.status),r.phone&&(n.phone=r.phone),r.password&&(n.password=await (0,u.c_)(r.password)),r.organizationId&&(n.organization={connect:{id:r.organizationId}}),r.bio&&(n.bio=r.bio),r.interests&&r.interests.length>0&&(n.userInterests={deleteMany:{},create:r.interests.map(e=>({interestId:e}))});let s=await l._.user.update({where:{id:t.id},data:n,select:{id:!0,firstName:!0,lastName:!0,email:!0,role:!0,status:!0,phone:!0,bio:!0,organizationId:!0}});return await l._.auditLog.create({data:{userId:o.id,action:"UPDATE_USER",entityType:"User",entityId:t.id,createdAt:new Date}}),i.NextResponse.json({data:s,status:200})}catch(e){if(console.error("Error updating user:",e),e instanceof p.jm)return i.NextResponse.json({error:"Invalid data",details:e.errors,status:400},{status:400});return i.NextResponse.json({error:"Failed to update user",status:500},{status:500})}}async function Z(e,{params:t}){let a=e.headers.get("authorization")?.replace("Bearer ","");if(!a)return i.NextResponse.json({error:"No token provided",status:401},{status:401});let o=(0,u.WX)(a);if(!o||"ADMIN"!==o.role)return i.NextResponse.json({error:"Unauthorized",status:401},{status:401});try{return await l._.user.delete({where:{id:t.id}}),await l._.auditLog.create({data:{userId:o.id,action:"DELETE_USER",entityType:"User",entityId:t.id,createdAt:new Date}}),i.NextResponse.json({data:{success:!0},status:200})}catch(e){return console.error("Error deleting user:",e),i.NextResponse.json({error:"Failed to delete user",status:500},{status:500})}}let f=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/users/[id]/route",pathname:"/api/admin/users/[id]",filename:"route",bundlePath:"app/api/admin/users/[id]/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\admin\\users\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:R,serverHooks:I}=f,h="/api/admin/users/[id]/route";function x(){return(0,s.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:R})}},90455:(e,t,a)=>{a.d(t,{Gv:()=>l,RA:()=>u,WX:()=>d,c_:()=>i});var o=a(98691),r=a(41482),n=a.n(r);let s=process.env.JWT_SECRET||"your-secret-key";async function i(e){return o.ZP.hash(e,12)}async function l(e,t){return o.ZP.compare(e,t)}function u(e){let t={id:e.id,email:e.email,role:e.role,firstName:e.firstName,lastName:e.lastName,organizationId:e.organizationId},a=n().sign(t,s,{expiresIn:"7d"});return console.log("Generated token payload:",t),console.log("Generated token:",a),a}function d(e){try{let t=n().verify(e,s);return console.log("Decoded token:",t),t}catch(e){return console.error("Token verification failed:",e.message),null}}},72331:(e,t,a)=>{a.d(t,{_:()=>r});var o=a(53524);let r=globalThis.prisma??new o.PrismaClient},30971:(e,t,a)=>{a.d(t,{K3:()=>s,Pc:()=>d,dm:()=>n,g2:()=>u,gY:()=>p,jT:()=>l,lp:()=>i});var o=a(91585),r=a(53524);let n=o.Ry({email:o.Z_().email("อีเมลไม่ถูกต้อง"),password:o.Z_().min(1,"กรุณากรอกรหัสผ่าน")}),s=o.Ry({requestId:o.Z_().min(1,"กรุณาเลือกคำขอ"),amount:o.Rx().positive("จำนวนเงินต้องมากกว่า 0"),message:o.Z_().optional(),anonymous:o.O7().default(!1),paymentMethod:o.Z_().min(1,"กรุณาเลือกวิธีการชำระเงิน")}),i=o.Ry({requestId:o.Z_().min(1,"กรุณาเลือกคำขอ"),message:o.Z_().min(10,"ข้อความต้องมีอย่างน้อย 10 ตัวอักษร"),skills:o.Z_().optional(),experience:o.Z_().optional(),availability:o.Z_().optional(),hoursCommitted:o.Rx().positive().optional()});o.Ry({title:o.Z_().min(1,"กรุณากรอกหัวข้อ"),content:o.Z_().min(50,"เนื้อหาต้องมีอย่างน้อย 50 ตัวอักษร"),requestId:o.Z_().optional(),images:o.IX(o.Z_()).default([])});let l=o.Ry({title:o.Z_().min(1,"ต้องระบุหัวข้อ"),description:o.Z_().min(1,"ต้องระบุรายละเอียด"),category:o.Z_().min(1,"ต้องระบุหมวดหมู่"),address:o.Z_().nullable(),urgency:o.Km(["LOW","MEDIUM","HIGH","URGENT"]).optional().default("LOW"),acceptsMoney:o.O7().optional().default(!1),acceptsItems:o.O7().optional().default(!1),acceptsVolunteer:o.O7().optional().default(!1),targetAmount:o.Rx().optional().default(0),itemsNeeded:o.IX(o.Z_()).optional().nullable(),volunteersNeeded:o.Rx().int().min(0).optional().default(0),volunteerSkills:o.IX(o.Z_()).optional().default([]),volunteerDuration:o.Z_().nullable(),images:o.IX(o.Z_().url()).optional().default([]),documents:o.Ry({detailedAddress:o.Z_().nullable(),contactPhone:o.Z_().nullable(),bankAccount:o.Ry({bank:o.Z_().optional(),accountNumber:o.Z_().optional(),accountName:o.Z_().optional()}).optional(),organizationDetails:o.Ry({organizationType:o.Z_().optional(),registrationNumber:o.Z_().optional(),taxId:o.Z_().optional()}).optional()}).optional()}),u=o.Ry({title:o.Z_().optional(),description:o.Z_().optional(),categoryId:o.Z_().optional(),targetAmount:o.Rx().optional(),address:o.Z_().optional(),urgency:o.Km(["LOW","MEDIUM","HIGH"]).optional(),acceptsMoney:o.O7().optional(),acceptsItems:o.O7().optional(),acceptsVolunteer:o.O7().optional(),itemsNeeded:o.IX(o.Z_()).optional(),volunteersNeeded:o.Rx().optional(),volunteerSkills:o.IX(o.Z_()).optional(),volunteerDuration:o.Z_().optional(),images:o.IX(o.Z_()).optional(),documents:o.IM(o.Z_(),o.Yj()).optional(),status:o.Km(["PENDING","COMPLETED","CANCELLED","DRAFT","APPROVED","REJECTED"]).optional(),expiresAt:o.Z_().datetime().optional()}),d=o.Ry({email:o.Z_().email("กรุณาระบุอีเมลที่ถูกต้อง"),password:o.Z_().min(8,"รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร"),firstName:o.Z_().min(1,"กรุณาระบุชื่อ"),lastName:o.Z_().min(1,"กรุณาระบุนามสกุล"),phone:o.Z_().min(10,"กรุณาระบุหมายเลขโทรศัพท์ที่ถูกต้อง").regex(/^\d{10}$/,"หมายเลขโทรศัพท์ต้องมี 10 หลัก"),role:o.jb(r.user_role,{errorMap:()=>({message:"กรุณาระบุบทบาท"})}),organizationId:o.Z_().optional(),newOrganizationName:o.Z_().optional(),organizationType:o.jb(r.organization_type,{errorMap:()=>({message:"กรุณาระบุประเภทองค์กรที่ถูกต้อง"})}).optional(),registrationNumber:o.Z_().optional(),templeId:o.Z_().optional(),interests:o.IX(o.Z_()).optional(),bio:o.Z_().optional(),documents:o.Ry({idCard:o.Yj().optional(),organizationCert:o.Yj().optional()}).optional()}),p=d.refine(e=>"ORGANIZER"!==e.role||e.organizationId&&"other"!==e.organizationId||e.newOrganizationName&&e.organizationType,{message:"กรุณาระบุข้อมูลองค์กรให้ครบถ้วน (ต้องมี newOrganizationName และ organizationType) สำหรับผู้จัดงาน",path:["organizationId","organizationType"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[9276,5972,1482,8691,1585],()=>a(33195));module.exports=o})();