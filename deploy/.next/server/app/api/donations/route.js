"use strict";(()=>{var e={};e.id=3922,e.ids=[3922],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},61349:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{POST:()=>l});var s=r(49303),n=r(88716),a=r(60670),i=r(87070),u=r(30971),p=r(24544),d=r(92704);async function l(e){try{let t=await (0,d.lj)(e);if(200!==t.status)return t;let r=e.headers.get("x-user-id"),o=await e.json(),s=u.K3.parse(o),n=await p.sK.create({...s,type:"MONEY",status:"PENDING",donor:{connect:{id:r}},request:{connect:{id:s.requestId}},transactionId:`TXN_${Date.now()}_${Math.random().toString(36).substr(2,9)}`});return i.NextResponse.json({message:"บริจาคสำเร็จ",donation:n})}catch(e){if(console.error("Create donation error:",e),"ZodError"===e.name)return i.NextResponse.json({error:"ข้อมูลไม่ถูกต้อง",details:e.errors},{status:400});return i.NextResponse.json({error:"เกิดข้อผิดพลาดในการบริจาค"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/donations/route",pathname:"/api/donations",filename:"route",bundlePath:"app/api/donations/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\donations\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:g}=c,m="/api/donations/route";function f(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},92704:(e,t,r)=>{r.d(t,{So:()=>a,lj:()=>n});var o=r(87070),s=r(90455);async function n(e){let t=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!t)return o.NextResponse.json({error:"ไม่พบ token การยืนยันตัวตน"},{status:401});let r=await (0,s.WX)(t);if(!r)return o.NextResponse.json({error:"Token ไม่ถูกต้องหรือหมดอายุ"},{status:401});let n=new Headers(e.headers);return n.set("x-user-id",r.id),n.set("x-user-role",r.role),o.NextResponse.next({request:{headers:n}})}async function a(e){let t=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!t)return console.log("No token provided"),null;let r=await (0,s.WX)(t);return console.log("Authenticated user:",r),r||null}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,1482,8691,1585,603],()=>r(61349));module.exports=o})();