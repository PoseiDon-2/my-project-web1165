"use strict";(()=>{var e={};e.id=9967,e.ids=[9967],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},41728:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>x,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>d});var o=t(49303),n=t(88716),a=t(60670),u=t(87070),i=t(30971),p=t(24544),l=t(92704);async function d(e){try{let r=await (0,l.lj)(e);if(200!==r.status)return r;let t=e.headers.get("x-user-id");if(!t)return u.NextResponse.json({error:"ไม่พบข้อมูลผู้ใช้"},{status:401});let s=await e.json(),o=i.lp.parse(s);if(!o.requestId)return u.NextResponse.json({error:"ต้องระบุ requestId"},{status:400});let n=await p.TX.create({...o,status:"APPLIED",volunteer:{connect:{id:t}},request:{connect:{id:o.requestId}}});return u.NextResponse.json({message:"สมัครเป็นอาสาสมัครสำเร็จ",application:n})}catch(e){if(console.error("Create volunteer application error:",e),"ZodError"===e.name)return u.NextResponse.json({error:"ข้อมูลไม่ถูกต้อง",details:e.errors},{status:400});return u.NextResponse.json({error:"เกิดข้อผิดพลาดในการสมัครเป็นอาสาสมัคร"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/volunteers/route",pathname:"/api/volunteers",filename:"route",bundlePath:"app/api/volunteers/route"},resolvedPagePath:"D:\\testProject\\test-project\\app\\api\\volunteers\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:h}=c,f="/api/volunteers/route";function g(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},92704:(e,r,t)=>{t.d(r,{So:()=>a,lj:()=>n});var s=t(87070),o=t(90455);async function n(e){let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!r)return s.NextResponse.json({error:"ไม่พบ token การยืนยันตัวตน"},{status:401});let t=await (0,o.WX)(r);if(!t)return s.NextResponse.json({error:"Token ไม่ถูกต้องหรือหมดอายุ"},{status:401});let n=new Headers(e.headers);return n.set("x-user-id",t.id),n.set("x-user-role",t.role),s.NextResponse.next({request:{headers:n}})}async function a(e){let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("auth-token")?.value;if(!r)return console.log("No token provided"),null;let t=await (0,o.WX)(r);return console.log("Authenticated user:",t),t||null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,1482,8691,1585,603],()=>t(41728));module.exports=s})();