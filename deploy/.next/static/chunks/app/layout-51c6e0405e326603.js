(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{8792:function(e,t,r){Promise.resolve().then(r.t.bind(r,7960,23)),Promise.resolve().then(r.bind(r,4738))},4738:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return s},a:function(){return u}});var o=r(7437),a=r(2265),n=r(3464);let i=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("token");e?(n.Z.defaults.headers.common.Authorization="Bearer ".concat(e),n.Z.get("/api/auth/me").then(t=>{console.log("Fetched user data:",t.data.user),s({...t.data.user,token:e})}).catch(e=>{console.error("Failed to fetch user data:",e),localStorage.removeItem("token"),delete n.Z.defaults.headers.common.Authorization}).finally(()=>d(!1))):d(!1)},[]);let l=async(e,t)=>{d(!0);try{let r=await n.Z.post("/api/auth/login",{email:e,password:t}),o=r.data.token;if(!o)throw Error("Token not received");return localStorage.setItem("token",o),n.Z.defaults.headers.common.Authorization="Bearer ".concat(o),s({...r.data.user,token:o}),console.log("Login successful, user:",r.data.user),d(!1),!0}catch(e){return console.error("Login error:",e),d(!1),!1}},c=async e=>{d(!0);try{var t,r;let o=new FormData;o.append("email",e.email),o.append("password",e.password),o.append("firstName",e.firstName),o.append("lastName",e.lastName),o.append("phone",e.phone),o.append("role",e.role),e.organizationId&&o.append("organizationId",e.organizationId),e.newOrganizationName&&o.append("newOrganizationName",e.newOrganizationName),e.organizationType&&o.append("organizationType",e.organizationType),e.registrationNumber&&o.append("registrationNumber",e.registrationNumber),e.templeId&&o.append("templeId",e.templeId),e.interests&&o.append("interests",JSON.stringify(e.interests)),(null===(t=e.documents)||void 0===t?void 0:t.idCard)&&o.append("idCard",e.documents.idCard),(null===(r=e.documents)||void 0===r?void 0:r.organizationCert)&&o.append("organizationCert",e.documents.organizationCert);let a=await n.Z.post("/api/auth/register",o,{headers:{"Content-Type":"multipart/form-data"}}),i=a.data.token;if(!i)throw Error("Token not received");return localStorage.setItem("token",i),n.Z.defaults.headers.common.Authorization="Bearer ".concat(i),s({...a.data.user,token:i}),console.log("Register successful, user:",a.data.user),d(!1),!0}catch(e){return console.error("Register error:",e),d(!1),!1}},p=async e=>{d(!0);try{return await n.Z.post("/api/auth/send-otp",{email:e}),console.log("OTP sent to:",e),d(!1),!0}catch(e){return console.error("Send OTP error:",e),d(!1),!1}},m=async(e,t)=>{d(!0);try{let r=await n.Z.post("/api/auth/verify-otp",{email:e,otp:t});return console.log("OTP verification result:",r.data.success),d(!1),r.data.success}catch(e){return console.error("Verify OTP error:",e),d(!1),!1}};return(0,o.jsx)(i.Provider,{value:{user:r,login:l,register:c,sendOTP:p,verifyOTP:m,logout:()=>{s(null),localStorage.removeItem("token"),delete n.Z.defaults.headers.common.Authorization,console.log("User logged out")},setUser:s,isLoading:u},children:t})}function u(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7960:function(){}},function(e){e.O(0,[3587,3464,2971,2117,1744],function(){return e(e.s=8792)}),_N_E=e.O()}]);