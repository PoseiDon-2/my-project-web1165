(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4195],{6521:function(e,t,i){Promise.resolve().then(i.bind(i,4637))},4637:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return b}});var s=i(7437),a=i(2265),n=i(6070),r=i(2869),l=i(5974),c=i(2339),d=i(6110),o=i(2805),m=i(3327),u=i(2023),x=i(7414),p=i(9232),h=i(8617),g=i(6973),v=i(4738),f=i(7992);let j=[{id:"theme_gold",name:"ธีมทอง",description:"เปลี่ยนธีมโปรไฟล์เป็นสีทองหรูหรา",category:"profile",pointsCost:500,image:"/placeholder-qnb7c.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01")},{id:"theme_platinum",name:"ธีมแพลทินัม",description:"ธีมสีเงินแพลทินัมสุดพรีเมียม",category:"profile",pointsCost:1e3,image:"/placeholder-kzrrr.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01")},{id:"theme_diamond",name:"ธีมเพชร",description:"ธีมเพชรสุดหรู สำหรับผู้บริจาคระดับตำนาน",category:"profile",pointsCost:2500,image:"/placeholder-bdpu4.png",isActive:!0,isLimited:!0,limitQuantity:100,remainingQuantity:87,createdBy:"system",createdAt:new Date("2024-01-01"),requirements:{minLevel:5}},{id:"badge_heart",name:"ตราหัวใจทอง",description:"ตราสัญลักษณ์หัวใจทองคำ",category:"badge",pointsCost:300,image:"/placeholder-a5wmf.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01")},{id:"badge_crown",name:"มงกุฎแห่งความดี",description:"มงกุฎสำหรับผู้บริจาคชั้นสูง",category:"badge",pointsCost:800,image:"/golden-crown-badge.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01"),requirements:{minLevel:3}},{id:"frame_rainbow",name:"กรอบสีรุ้ง",description:"กรอบโปรไฟล์สีรุ้งสวยงาม",category:"profile",pointsCost:400,image:"/placeholder-xxg4t.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01")},{id:"frame_fire",name:"กรอบเปลวไฟ",description:"กรอบเปลวไฟสำหรับผู้บริจาคที่ร้อนแรง",category:"profile",pointsCost:600,image:"/placeholder-n8zrx.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01")},{id:"feature_priority",name:"การแสดงผลพิเศษ",description:"คำขอบริจาคของคุณจะแสดงในลำดับต้นๆ",category:"feature",pointsCost:1500,image:"/placeholder-4h2yn.png",isActive:!0,isLimited:!1,createdBy:"system",createdAt:new Date("2024-01-01"),requirements:{minLevel:4}}];function y(){let{user:e}=(0,v.a)(),[t,i]=(0,a.useState)(null),[y,N]=(0,a.useState)(null),[w,b]=(0,a.useState)(!1),[C,A]=(0,a.useState)("all"),[L,k]=(0,a.useState)(!0),[S,P]=(0,a.useState)(null),Z=async()=>{if(!(null==e?void 0:e.id)){P("กรุณาเข้าสู่ระบบเพื่อดูร้านรางวัล"),k(!1);return}k(!0);try{let t=await g.g.getUserPoints(e.id,e.token);i(t),P(null)}catch(e){console.error("Failed to load user points:",e),P("ไม่สามารถโหลดข้อมูลคะแนนได้"),(0,f.Am)({title:"ข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลคะแนนได้ กรุณาลองใหม่",variant:"destructive"})}finally{k(!1)}};(0,a.useEffect)(()=>{Z()},[e]);let _=j.filter(e=>"all"===C||e.category===C),q=e=>{var i;return!!t&&void 0!==t.availablePoints&&void 0!==t.level&&!(t.availablePoints<e.pointsCost)&&(null===(i=e.requirements)||void 0===i||!i.minLevel||!(t.level<e.requirements.minLevel))&&(!e.isLimited||0!==e.remainingQuantity)},z=e=>{N(e),b(!0)},B=async()=>{if(!y||!e||!t){(0,f.Am)({title:"ข้อผิดพลาด",description:"ข้อมูลไม่ครบถ้วน กรุณาลองใหม่",variant:"destructive"}),b(!1),N(null);return}try{if(await g.g.spendPoints(e.id,y.pointsCost,"reward_purchase","ซื้อ ".concat(y.name),y.id)){let t=await fetch("/api/rewards/".concat(e.id),{method:"POST",headers:{"Content-Type":"application/json",...e.token&&{Authorization:"Bearer ".concat(e.token)}},body:JSON.stringify({rewardId:y.id,isActive:!0,createdAt:new Date})});if(!t.ok)throw Error("Failed to save reward: ".concat(t.statusText));let s=await g.g.getUserPoints(e.id,e.token);i(s),(0,f.Am)({title:"ซื้อรางวัลสำเร็จ!",description:"คุณได้รับ ".concat(y.name," แล้ว")})}else(0,f.Am)({title:"ซื้อรางวัลไม่สำเร็จ",description:"คะแนนไม่เพียงพอหรือเกิดข้อผิดพลาด",variant:"destructive"})}catch(e){console.error("Error purchasing reward:",e),(0,f.Am)({title:"ข้อผิดพลาด",description:"เกิดข้อผิดพลาดขณะซื้อรางวัล กรุณาลองใหม่",variant:"destructive"})}b(!1),N(null)},Q=e=>{switch(e){case"profile":return(0,s.jsx)(o.Z,{className:"h-4 w-4"});case"badge":return(0,s.jsx)(m.Z,{className:"h-4 w-4"});case"feature":return(0,s.jsx)(u.Z,{className:"h-4 w-4"});default:return(0,s.jsx)(x.Z,{className:"h-4 w-4"})}};return e&&e.id?L?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,s.jsx)("p",{children:"กำลังโหลดข้อมูลคะแนน..."})}):S?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)("p",{className:"text-red-600",children:S}),(0,s.jsx)(r.z,{onClick:Z,className:"mt-4",children:"ลองใหม่"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(n.Zb,{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200",children:(0,s.jsx)(n.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,s.jsx)(p.Z,{className:"h-8 w-8 text-yellow-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"คะแนนที่ใช้ได้"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-yellow-700",children:t&&void 0!==t.availablePoints?t.availablePoints.toLocaleString("th-TH"):"0"})]})]}),(0,s.jsxs)(l.C,{variant:"outline",className:"px-4 py-2 text-lg",children:[(0,s.jsx)(h.Z,{className:"h-5 w-5 mr-2"}),(null==t?void 0:t.levelName)||"N/A"]})]})})}),(0,s.jsxs)(c.mQ,{value:C,onValueChange:A,children:[(0,s.jsxs)(c.dr,{className:"grid w-full grid-cols-4",children:[(0,s.jsxs)(c.SP,{value:"all",className:"flex items-center gap-2",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),"ทั้งหมด"]}),(0,s.jsxs)(c.SP,{value:"profile",className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"}),"ธีม"]}),(0,s.jsxs)(c.SP,{value:"badge",className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4"}),"ตรา"]}),(0,s.jsxs)(c.SP,{value:"feature",className:"flex items-center gap-2",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4"}),"ฟีเจอร์"]})]}),(0,s.jsx)(c.nU,{value:C,className:"mt-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(e=>{var i,a;return(0,s.jsxs)(n.Zb,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[(0,s.jsxs)("div",{className:"aspect-square relative",children:[(0,s.jsx)("img",{src:e.image||"/placeholder.svg",alt:e.name,className:"w-full h-full object-cover"}),e.isLimited&&void 0!==e.remainingQuantity&&void 0!==e.limitQuantity&&(0,s.jsxs)(l.C,{className:"absolute top-2 right-2 bg-red-500",children:["จำกัด ",e.remainingQuantity,"/",e.limitQuantity]})]}),(0,s.jsxs)(n.Ol,{className:"pb-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(n.ll,{className:"text-lg",children:e.name}),Q(e.category)]}),(0,s.jsx)(n.SZ,{children:e.description})]}),(0,s.jsx)(n.aY,{className:"pb-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 text-yellow-500"}),(0,s.jsx)("span",{className:"font-semibold",children:e.pointsCost.toLocaleString("th-TH")})]}),(null===(i=e.requirements)||void 0===i?void 0:i.minLevel)&&(0,s.jsxs)(l.C,{variant:"outline",className:"text-xs",children:["ระดับ ",e.requirements.minLevel,"+"]})]})}),(0,s.jsx)(n.eW,{children:(0,s.jsx)(r.z,{className:"w-full",onClick:()=>z(e),disabled:!q(e),variant:q(e)?"default":"secondary",children:q(e)?"ซื้อรางวัล":t&&void 0!==t.availablePoints&&t.availablePoints<e.pointsCost?"คะแนนไม่พอ":(null===(a=e.requirements)||void 0===a?void 0:a.minLevel)&&t&&void 0!==t.level&&t.level<e.requirements.minLevel?"ระดับไม่พอ":e.isLimited&&0===e.remainingQuantity?"หมดแล้ว":"ไม่สามารถซื้อได้"})})]},e.id)})})})]}),(0,s.jsx)(d.Vq,{open:w,onOpenChange:b,children:(0,s.jsxs)(d.cZ,{children:[(0,s.jsxs)(d.fK,{children:[(0,s.jsx)(d.$N,{children:"ยืนยันการซื้อรางวัล"}),(0,s.jsxs)(d.Be,{children:['คุณต้องการซื้อ "',null==y?void 0:y.name,'" ด้วยคะแนน'," ",null==y?void 0:y.pointsCost.toLocaleString("th-TH")," คะแนนใช่หรือไม่?"]})]}),(0,s.jsxs)(d.cN,{children:[(0,s.jsx)(r.z,{variant:"outline",onClick:()=>b(!1),children:"ยกเลิก"}),(0,s.jsx)(r.z,{onClick:B,children:"ยืนยันการซื้อ"})]})]})})]}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,s.jsx)("p",{children:"กรุณาเข้าสู่ระบบเพื่อดูร้านรางวัล"})})}var N=i(2660),w=i(9376);function b(){let e=(0,w.useRouter)();return(0,s.jsxs)("div",{className:"container mx-auto px-20 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(r.z,{variant:"ghost",onClick:()=>e.back(),className:"mb-4 p-2 hover:bg-gray-100",children:[(0,s.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"กลับ"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"ร้านรางวัล"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"ใช้คะแนนที่สะสมจากการบริจาคเพื่อแลกรางวัลพิเศษ"})]}),(0,s.jsx)(y,{})]})}},2339:function(e,t,i){"use strict";i.d(t,{SP:function(){return d},dr:function(){return c},mQ:function(){return l},nU:function(){return o}});var s=i(7437),a=i(2265),n=i(1312),r=i(4508);let l=n.fC,c=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...a})});c.displayName=n.aV.displayName;let d=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)(n.xz,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...a})});d.displayName=n.xz.displayName;let o=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...a})});o.displayName=n.VY.displayName}},function(e){e.O(0,[2582,3464,7514,9783,4841,3211,2971,2117,1744],function(){return e(e.s=6521)}),_N_E=e.O()}]);