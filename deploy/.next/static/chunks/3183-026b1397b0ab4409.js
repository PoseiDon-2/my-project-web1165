"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3183],{3183:function(e,a,s){s.d(a,{Z:function(){return v}});var t=s(7437),r=s(2265),l=s(6110),n=s(2869),i=s(5186),c=s(6815),d=s(6818),o=s(6070),m=s(5271),h=s(7689),x=s(804),u=s(2489),p=s(9322),j=s(401),g=s(7992);function v(e){let{isOpen:a,onClose:s,requestId:v,requestTitle:N,onUploadComplete:f}=e,[y,b]=(0,r.useState)([]),[w,_]=(0,r.useState)(""),[C,F]=(0,r.useState)(""),[k,z]=(0,r.useState)(""),[D,M]=(0,r.useState)(""),[S,B]=(0,r.useState)(!1),[I,P]=(0,r.useState)(!1),Z=e=>{if(!e)return;let a=Array.from(e).filter(e=>{let a=e.type.startsWith("image/")||"application/pdf"===e.type,s=e.size<=10485760;return a?!!s||((0,g.Am)({title:"ไฟล์ใหญ่เกินไป",description:"".concat(e.name," มีขนาดเกิน 10MB"),variant:"destructive"}),!1):((0,g.Am)({title:"ไฟล์ไม่ถูกต้อง",description:"".concat(e.name," ไม่ใช่ไฟล์รูปภาพหรือ PDF"),variant:"destructive"}),!1)});b(e=>[...e,...a])},A=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?P(!0):"dragleave"===e.type&&P(!1)},E=e=>{b(a=>a.filter((a,s)=>s!==e))},O=async()=>{if(0===y.length){(0,g.Am)({title:"กรุณาเลือกไฟล์",description:"กรุณาอัปโหลดสลิปหรือใบเสร็จ",variant:"destructive"});return}B(!0);try{await new Promise(e=>setTimeout(e,2e3));let e=m.X.createReceipt({donationId:"manual_".concat(Date.now()),requestId:v,requestTitle:N,donorId:"manual_upload",donorName:k||"ไม่ระบุชื่อ",amount:C?Number(C):void 0,type:"money",paymentMethod:"Manual Upload",transactionId:w,message:D,isAnonymous:!k,pointsEarned:0}),a=y.map(e=>({name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)}));localStorage.setItem("receipt_files_".concat(e.id),JSON.stringify(a)),(0,g.Am)({title:"อัปโหลดสำเร็จ",description:"สลิปการรับเงินได้ถูกบันทึกแล้ว"}),b([]),_(""),F(""),z(""),M(""),null==f||f(),s()}catch(e){(0,g.Am)({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถอัปโหลดไฟล์ได้ กรุณาลองใหม่",variant:"destructive"})}finally{B(!1)}},R=e=>{if(0===e)return"0 Bytes";let a=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]},T=()=>{b([]),_(""),F(""),z(""),M(""),B(!1),P(!1)},G=()=>{T(),s()};return(0,t.jsx)(l.Vq,{open:a,onOpenChange:G,children:(0,t.jsxs)(l.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(l.fK,{children:[(0,t.jsx)(l.$N,{children:"อัปโหลดสลิปการรับเงิน"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["สำหรับ: ",N]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(c._,{children:"สลิปการรับเงิน / ใบเสร็จ *"}),(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(I?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:e=>{e.preventDefault(),e.stopPropagation(),P(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&Z(e.dataTransfer.files)},children:[(0,t.jsx)(h.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"ลากไฟล์มาวางที่นี่ หรือคลิกเพื่อเลือกไฟล์"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"รองรับไฟล์ JPG, PNG, PDF ขนาดไม่เกิน 10MB"}),(0,t.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>{var e;return null===(e=document.getElementById("file-upload"))||void 0===e?void 0:e.click()},children:"เลือกไฟล์"}),(0,t.jsx)("input",{id:"file-upload",type:"file",multiple:!0,accept:"image/*,.pdf",onChange:e=>Z(e.target.files),className:"hidden"})]}),y.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c._,{children:["ไฟล์ที่เลือก (",y.length,")"]}),(0,t.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:y.map((e,a)=>(0,t.jsx)(o.Zb,{children:(0,t.jsx)(o.aY,{className:"p-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(x.Z,{className:"w-5 h-5 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate max-w-[200px]",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:R(e.size)})]})]}),(0,t.jsx)(n.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(a),children:(0,t.jsx)(u.Z,{className:"w-4 h-4"})})]})})},a))})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"receiptNumber",children:"เลขที่ใบเสร็จ / รหัสอ้างอิง"}),(0,t.jsx)(i.I,{id:"receiptNumber",placeholder:"เช่น RCP-001234",value:w,onChange:e=>_(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"amount",children:"จำนวนเงิน (บาท)"}),(0,t.jsx)(i.I,{id:"amount",type:"number",placeholder:"0.00",value:C,onChange:e=>F(e.target.value),min:"0",step:"0.01"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"donorName",children:"ชื่อผู้บริจาค (ไม่บังคับ)"}),(0,t.jsx)(i.I,{id:"donorName",placeholder:"ระบุชื่อผู้บริจาค หรือเว้นว่างหากไม่ประสงค์ออกนาม",value:k,onChange:e=>z(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"notes",children:"หมายเหตุเพิ่มเติม"}),(0,t.jsx)(d.g,{id:"notes",placeholder:"รายละเอียดเพิ่มเติมเกี่ยวกับการรับเงิน...",rows:3,value:D,onChange:e=>M(e.target.value)})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(p.Z,{className:"w-5 h-5 text-blue-600 mt-0.5"}),(0,t.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"ข้อมูลสำคัญ:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-xs",children:[(0,t.jsx)("li",{children:"• สลิปที่อัปโหลดจะถูกเก็บไว้เป็นหลักฐานการรับเงิน"}),(0,t.jsx)("li",{children:"• ข้อมูลจะถูกใช้สำหรับการออกใบเสร็จและรายงาน"}),(0,t.jsx)("li",{children:"• กรุณาตรวจสอบความถูกต้องของข้อมูลก่อนอัปโหลด"})]})]})]})}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,t.jsx)(n.z,{onClick:O,disabled:S||0===y.length,className:"flex-1",children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"กำลังอัปโหลด..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"อัปโหลดสลิป"]})}),(0,t.jsx)(n.z,{variant:"outline",onClick:G,disabled:S,children:"ยกเลิก"})]})]})]})})}}}]);